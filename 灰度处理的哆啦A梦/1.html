<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>åè‰²çš„å“†å•¦Aæ¢¦</title>
	</head>

	<body>
		<canvas id="myCanvas" width="1000px" height="600" style="box-shadow: 0 0 50px 5px #000;background:skyblue;display: block; margin: 0 auto;">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒcanvas</canvas>
		<script type="text/javascript">
			var mc = document.getElementById('myCanvas');
			var ctx = mc.getContext('2d');
			var img = new Image();
			img.src = '666.jpg';
			document.getElementsByTagName('body')[0].appendChild(img);
			//ğŸä¸ºImageç±»æ·»åŠ åŸå‹æ–¹æ³•,å°†å›¾ç‰‡æ·»åŠ åˆ°canvasç”»å¸ƒä¸Š;
			Image.prototype.drawInCanvas = function(x, y, imgWidth, imgHeight, drawCtx) {
				this.ox = x;
				this.oy = y;
				this.width = imgWidth;
				this.height = imgHeight;
				this.drawCtx = drawCtx;
				drawCtx.drawImage(this, x, y, imgWidth, imgHeight);
				//è·å–åˆ°åƒç´ æ•°æ®
				this.imgDate = drawCtx.getImageData(this.ox, this.oy, this.width, this.height);
				this.data = this.imgDate.data;
			}

			//ğŸä¸ºImageç±»æ·»åŠ åœ¨canvasä¸Šçš„å›¾åšç°åº¦å¤„ç†
			Image.prototype.huiduColor = function() {
				if(this.ox == undefined || this.oy == undefined || this.width == undefined || this.height == undefined || this.imgDate == undefined || this.data == undefined) {
					alert('æ²¡æœ‰æ‰¾åˆ°cnavasä¸Šçš„åŸå›¾ç‰‡!');
				} else {
					for(var i = 0; i < this.data.length; i += 4) {
						this.data[i] = (this.data[i] + this.data[i + 1] + this.data[i + 2]) / 3;
						this.data[i + 1] = (this.data[i] + this.data[i + 1] + this.data[i + 2]) / 3;
						this.data[i + 2] = (this.data[i] + this.data[i + 1] + this.data[i + 2]) / 3;
					}
					this.drawCtx.putImageData(this.imgDate, this.ox, this.oy);
				}

			}


			img.onload = function() {
				img.drawInCanvas(10, 10, 400, 400, ctx);
				img.huiduColor();
			}
		</script>
	</body>

</html>